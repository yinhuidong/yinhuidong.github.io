<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Spring Data Jpa使用篇 | 二十</title><meta name="keywords" content="MyBatis"><meta name="author" content="二十"><meta name="copyright" content="二十"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Spring Data Jpa">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Data Jpa使用篇">
<meta property="og:url" content="https://yinhuidong.github.io/2022/01/11/MyBatis/Spring%20Data%20Jpa%E4%BD%BF%E7%94%A8%E7%AF%87/index.html">
<meta property="og:site_name" content="二十">
<meta property="og:description" content="Spring Data Jpa">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yinhuidong.github.io/images/cover/MyBatis.png">
<meta property="article:published_time" content="2022-01-11T06:37:31.534Z">
<meta property="article:modified_time" content="2022-01-11T06:41:57.741Z">
<meta property="article:author" content="二十">
<meta property="article:tag" content="MyBatis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yinhuidong.github.io/images/cover/MyBatis.png"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="https://yinhuidong.github.io/2022/01/11/MyBatis/Spring%20Data%20Jpa%E4%BD%BF%E7%94%A8%E7%AF%87/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":800},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Spring Data Jpa使用篇',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-01-11 14:41:57'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><meta name="referrer" content="no-referrer" /><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">118</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/%E5%85%B3%E4%BA%8E%E6%88%91/"><i class="fa-fw fas fa-user"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/cover/MyBatis.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">二十</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/%E5%85%B3%E4%BA%8E%E6%88%91/"><i class="fa-fw fas fa-user"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Spring Data Jpa使用篇</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-11T06:37:31.534Z" title="发表于 2022-01-11 14:37:31">2022-01-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-01-11T06:41:57.741Z" title="更新于 2022-01-11 14:41:57">2022-01-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MyBatis/">MyBatis</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>38分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Spring Data Jpa使用篇"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="一，orm思想和hibernate以及jpa"><a href="#一，orm思想和hibernate以及jpa" class="headerlink" title="一，orm思想和hibernate以及jpa"></a>一，orm思想和hibernate以及jpa</h1><h2 id="1-orm思想"><a href="#1-orm思想" class="headerlink" title="1.orm思想"></a>1.orm思想</h2><p><img src="https://img-blog.csdnimg.cn/20200909225317513.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTU5NjAyMg==,size_16,color_FFFFFF,t_70#pic_center#id=gKHe1&originHeight=542&originWidth=1340&originalType=binary&ratio=1&status=done&style=none"></p>
<p>主要目的：操作实体类就相当于操作数据库表</p>
<p>建立两个映射关系</p>
<pre><code>    `实体类`和 `表`
</code></pre>
<p>        <code>实体类中的属性</code> 和 <code>表中字段的映射关系</code></p>
<p>不再重点关注： <code>SQL语句</code></p>
<p>实现了ORM思想的框架：<code>mybatis</code>，<code>hibernate</code></p>
<h2 id="2-hibernate框架介绍"><a href="#2-hibernate框架介绍" class="headerlink" title="2. hibernate框架介绍"></a>2. hibernate框架介绍</h2><p>Hibernate是一个开放源代码的<code>对象关系映射框架</code>，它对JDBC进行了非常轻量级的对象封装，它将<code>POJO</code>与<code>数据库表</code>建立映射关系，是一个<code>全自动的orm框架</code>，hibernate可以自动生成SQL语句，自动执行，使得Java程序员可以随心所欲的使用<code>对象编程思维</code>来操纵数据库。</p>
<h2 id="3-jpa规范"><a href="#3-jpa规范" class="headerlink" title="3.jpa规范"></a>3.jpa规范</h2><p><img src="https://img-blog.csdnimg.cn/20200909225337404.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTU5NjAyMg==,size_16,color_FFFFFF,t_70#pic_center#id=SoAwV&originHeight=542&originWidth=1340&originalType=binary&ratio=1&status=done&style=none"></p>
<p>JPA的全称是Java Persistence API， 即Java 持久化API，是SUN公司推出的一套基于ORM的规范，内部是由一系列的接口和抽象类构成。</p>
<p><strong>JPA通过JDK 5.0注解描述对象－关系表的映射关系，并将运行期的实体对象持久化到数据库中。</strong></p>
<h3 id="JPA与hibernate的关系"><a href="#JPA与hibernate的关系" class="headerlink" title="JPA与hibernate的关系"></a>JPA与hibernate的关系</h3><p><img src="https://img-blog.csdnimg.cn/20200909225354254.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTU5NjAyMg==,size_16,color_FFFFFF,t_70#pic_center#id=ZTudi&originHeight=385&originWidth=762&originalType=binary&ratio=1&status=done&style=none"></p>
<p>JPA和Hibernate的关系就像JDBC和JDBC驱动的关系，JPA是规范，Hibernate除了作为ORM框架之外，它也是一种JPA实现。JPA怎么取代Hibernate呢？JDBC规范可以驱动底层数据库吗？答案是否定的，也就是说，如果使用JPA规范进行数据库操作，底层需要hibernate作为其实现类完成数据持久化工作。</p>
<h2 id="4-jpa的入门案例"><a href="#4-jpa的入门案例" class="headerlink" title="4.jpa的入门案例"></a>4.jpa的入门案例</h2><h3 id="1-案例：是客户的相关操作（增删改查）"><a href="#1-案例：是客户的相关操作（增删改查）" class="headerlink" title="1.案例：是客户的相关操作（增删改查）"></a>1.案例：是客户的相关操作（增删改查）</h3><pre><code>    客户：就是一家公司
</code></pre>
<h3 id="2-创建项目导入依赖"><a href="#2-创建项目导入依赖" class="headerlink" title="2.创建项目导入依赖"></a>2.创建项目导入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.hibernate.version</span>&gt;</span>5.0.7.Final<span class="tag">&lt;/<span class="name">project.hibernate.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- junit --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- hibernate对jpa的支持包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-entitymanager<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.hibernate.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- c3p0 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.hibernate.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- log日志 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Mysql and MariaDB --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="3-配置文件"><a href="#3-配置文件" class="headerlink" title="3.配置文件"></a>3.配置文件</h3><p>位置：配置到类路径下的一个叫做 <code>META-INF</code> 的文件夹下<br>命名：<code>persistence.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">persistence</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/persistence&quot;</span> <span class="attr">version</span>=<span class="string">&quot;2.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置持久化单元</span></span><br><span class="line"><span class="comment">		  name：持久化单元名称</span></span><br><span class="line"><span class="comment">		  transaction-type：事务类型</span></span><br><span class="line"><span class="comment">		 	  RESOURCE_LOCAL：本地事务管理</span></span><br><span class="line"><span class="comment">		 	  JTA：分布式事务管理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">persistence-unit</span> <span class="attr">name</span>=<span class="string">&quot;myJpa&quot;</span> <span class="attr">transaction-type</span>=<span class="string">&quot;RESOURCE_LOCAL&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置JPA规范的服务提供商 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">provider</span>&gt;</span>org.hibernate.jpa.HibernatePersistenceProvider<span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据库驱动 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据库地址 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/jpa&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据库用户名 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据库密码 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--jpa提供者的可选配置：我们的JPA规范的提供者为hibernate，所以jpa的核心配置中兼容hibernate的配 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--显示sql语句--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.show_sql&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.format_sql&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                建表方式</span></span><br><span class="line"><span class="comment">                create:每次执行都创建表</span></span><br><span class="line"><span class="comment">                update:没有表才创建</span></span><br><span class="line"><span class="comment">                none:不创建表</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.hbm2ddl.auto&quot;</span> <span class="attr">value</span>=<span class="string">&quot;update&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">persistence-unit</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">persistence</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="4-实体类"><a href="#4-实体类" class="headerlink" title="4.实体类"></a>4.实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yinhuidong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@createTime</span> 2020-06-01-21:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//作用：指定当前类是实体类。</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 作用：指定实体类和表之间的对应关系。</span></span><br><span class="line"><span class="comment"> * 属性：</span></span><br><span class="line"><span class="comment"> *   name：指定数据库表的名称</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Table(name = &quot;t_person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="comment">//作用：指定当前字段是主键。</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Id</span></span></span><br><span class="line"><span class="comment">     *     作用：指定主键的生成方式。。</span></span><br><span class="line"><span class="comment">     *     属性：</span></span><br><span class="line"><span class="comment">     *     strategy ：指定主键生成策略。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Column</span></span></span><br><span class="line"><span class="comment">     * 作用：指定实体类属性和数据库表之间的对应关系</span></span><br><span class="line"><span class="comment">     * 属性：</span></span><br><span class="line"><span class="comment">     *      name：指定数据库表的列名称。</span></span><br><span class="line"><span class="comment">     *      unique：是否唯一  </span></span><br><span class="line"><span class="comment">     *      nullable：是否可以为空  </span></span><br><span class="line"><span class="comment">     *      inserttable：是否可以插入  </span></span><br><span class="line"><span class="comment">     *      updateable：是否可以更新  </span></span><br><span class="line"><span class="comment">     *      columnDefinition: 定义建表时创建此列的DDL  </span></span><br><span class="line"><span class="comment">     *      secondaryTable: 从表名。如果此列不建在主表上（默认建在主表），</span></span><br><span class="line"><span class="comment">     *      该属性定义该列所在从表的名字搭建开发环境[重点]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_age&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_email&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_birth&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(Integer id, String name, Integer age, String email, Date birth)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">        <span class="keyword">this</span>.birth = birth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBirth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> birth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirth</span><span class="params">(Date birth)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.birth = birth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, email=&#x27;&quot;</span> + email + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, birth=&quot;</span> + birth +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="5-测试类"><a href="#5-测试类" class="headerlink" title="5.测试类"></a>5.测试类</h3><h4 id="jpa操作的操作步骤"><a href="#jpa操作的操作步骤" class="headerlink" title="jpa操作的操作步骤"></a>jpa操作的操作步骤</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">1.加载配置文件创建实体管理器工厂</span></span><br><span class="line">    <span class="attr">Persisitence：静态方法（根据持久化单元名称创建实体管理器工厂）</span></span><br><span class="line">        <span class="attr">createEntityMnagerFactory（持久化单元名称）</span></span><br><span class="line">    <span class="attr">作用：创建实体管理器工厂</span></span><br><span class="line"></span><br><span class="line"><span class="attr">2.根据实体管理器工厂，创建实体管理器</span></span><br><span class="line">    <span class="attr">EntityManagerFactory</span> <span class="string">：获取EntityManager对象</span></span><br><span class="line">    <span class="attr">方法：createEntityManager</span></span><br><span class="line">    <span class="meta">*</span> <span class="string">内部维护的很多的内容</span></span><br><span class="line">        <span class="attr">内部维护了数据库信息，</span></span><br><span class="line">        <span class="attr">维护了缓存信息</span></span><br><span class="line">        <span class="attr">维护了所有的实体管理器对象</span></span><br><span class="line">        <span class="attr">再创建EntityManagerFactory的过程中会根据配置创建数据库表</span></span><br><span class="line">    <span class="meta">*</span> <span class="string">EntityManagerFactory的创建过程比较浪费资源</span></span><br><span class="line">    <span class="attr">特点：线程安全的对象</span></span><br><span class="line">        <span class="attr">多个线程访问同一个EntityManagerFactory不会有线程安全问题</span></span><br><span class="line">    <span class="meta">*</span> <span class="string">如何解决EntityManagerFactory的创建过程浪费资源（耗时）的问题？</span></span><br><span class="line">    <span class="attr">思路：创建一个公共的EntityManagerFactory的对象</span></span><br><span class="line">    <span class="meta">*</span> <span class="string">静态代码块的形式创建EntityManagerFactory</span></span><br><span class="line"></span><br><span class="line"><span class="attr">3.创建事务对象，开启事务</span></span><br><span class="line">    <span class="attr">EntityManager对象：实体类管理器</span></span><br><span class="line">        <span class="attr">beginTransaction</span> : <span class="string">创建事务对象</span></span><br><span class="line">        <span class="attr">presist</span> <span class="string">： 保存</span></span><br><span class="line">        <span class="attr">merge</span>  <span class="string">： 更新</span></span><br><span class="line">        <span class="attr">remove</span> <span class="string">： 删除</span></span><br><span class="line">        <span class="meta">find/getRefrence</span> <span class="string">： 根据id查询</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">Transaction</span> <span class="string">对象 ： 事务</span></span><br><span class="line">        <span class="attr">begin：开启事务</span></span><br><span class="line">        <span class="attr">commit：提交事务</span></span><br><span class="line">        <span class="attr">rollback：回滚</span></span><br><span class="line"><span class="attr">4.增删改查操作</span></span><br><span class="line"><span class="attr">5.提交事务</span></span><br><span class="line"><span class="attr">6.释放资源</span></span><br></pre></td></tr></table></figure>


<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span></span>&#123;</span><br><span class="line">    EntityManagerFactory factory = Persistence.createEntityManagerFactory(<span class="string">&quot;myJpa&quot;</span>);</span><br><span class="line">    EntityManager em = factory.createEntityManager();</span><br><span class="line">    EntityTransaction tx = em.getTransaction();</span><br><span class="line">    tx.begin();</span><br><span class="line">    Person person = <span class="keyword">new</span> Person(<span class="keyword">null</span>,<span class="string">&quot;aaa&quot;</span>,<span class="number">22</span>,<span class="string">&quot;aaa@163.com&quot;</span>,<span class="keyword">new</span> Date());</span><br><span class="line">    em.persist(person);</span><br><span class="line">    tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="5-主键生成策略"><a href="#5-主键生成策略" class="headerlink" title="5.主键生成策略"></a>5.主键生成策略</h2><p><code>@GeneratedValue</code>:配置主键的生成策略<br><code>strategy</code><br><code>GenerationType.IDENTITY</code> ：自增，mysql<br>底层数据库必须支持自动增长（底层数据库支持的自动增长方式，对id自增）<br><code>GenerationType.SEQUENCE</code> : 序列，oracle<br>底层数据库必须支持序列<br><code>GenerationType.TABLE</code> : jpa提供的一种机制，通过一张数据库表的形式帮助我们完成主键自增<br><code>GenerationType.AUTO</code> ： 由程序自动的帮助我们选择主键生成策略</p>
<h2 id="6-JPA的API介绍"><a href="#6-JPA的API介绍" class="headerlink" title="6.JPA的API介绍"></a>6.JPA的API介绍</h2><h3 id="1-Persistence对象"><a href="#1-Persistence对象" class="headerlink" title="1.Persistence对象"></a>1.Persistence对象</h3><p><code>Persistence</code>对象主要作用是用于获取<code>EntityManagerFactory</code>对象的 。通过调用该类的<code>createEntityManagerFactory</code>静态方法，根据配置文件中持久化单元名称创建<code>EntityManagerFactory</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EntityManagerFactory factory = Persistence.createEntityManagerFactory(<span class="string">&quot;myJpa&quot;</span>);</span><br></pre></td></tr></table></figure>


<h3 id="2-EntityManagerFactory"><a href="#2-EntityManagerFactory" class="headerlink" title="2.EntityManagerFactory"></a>2.EntityManagerFactory</h3><p><code>EntityManagerFactory</code> 接口主要用来创建 <code>EntityManager</code> 实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EntityManager em = factory.createEntityManager();</span><br></pre></td></tr></table></figure>


<p>由于<code>EntityManagerFactory</code> 是一个线程安全的对象（即多个线程访问同一个<code>EntityManagerFactory</code> 对象不会有线程安全问题），并且<code>EntityManagerFactory</code> 的创建极其浪费资源，所以在使用JPA编程时，我们可以对<code>EntityManagerFactory</code> 的创建进行优化，只需要做到一个工程只存在一个<code>EntityManagerFactory</code> 即可。</p>
<h3 id="3-EntityManager"><a href="#3-EntityManager" class="headerlink" title="3. EntityManager"></a>3. EntityManager</h3><p>在 JPA 规范中,<code>EntityManager</code>是完成持久化操作的核心对象。实体类作为普通 java对象，只有在调用 <code>EntityManager</code>将其持久化后才会变成持久化对象。<code>EntityManager</code>对象在一组实体类与底层数据源之间进行 O/R 映射的管理。它可以用来管理和更新 <code>Entity Bean</code>, 根椐主键查找 <code>Entity Bean</code>, 还可以通过JPQL语句查询实体。我们可以通过调用<code>EntityManager</code>的方法完成获取事务，以及持久化数据库的操作</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">getTransaction</span> : <span class="string">获取事务对象</span></span><br><span class="line"><span class="attr">persist</span> <span class="string">： 保存操作</span></span><br><span class="line"><span class="attr">merge</span> <span class="string">： 更新操作</span></span><br><span class="line"><span class="attr">remove</span> <span class="string">： 删除操作</span></span><br><span class="line"><span class="meta">find/getReference</span> <span class="string">： 根据id查询</span></span><br></pre></td></tr></table></figure>


<h3 id="4-EntityTransaction"><a href="#4-EntityTransaction" class="headerlink" title="4.EntityTransaction"></a>4.EntityTransaction</h3><p>在 JPA 规范中, <code>EntityTransaction</code>是完成事务操作的核心对象，对于<code>EntityTransaction</code>在我们的java代码中承接的功能比较简单</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">begin：开启事务</span></span><br><span class="line"><span class="attr">commit：提交事务</span></span><br><span class="line"><span class="attr">rollback：回滚事务</span></span><br></pre></td></tr></table></figure>


<h2 id="7-抽取JPAUtil工具类"><a href="#7-抽取JPAUtil工具类" class="headerlink" title="7.   抽取JPAUtil工具类"></a>7.   抽取JPAUtil工具类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yinhuidong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@createTime</span> 2020-06-02-0:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> EntityManagerFactory factory;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        factory = Persistence.createEntityManagerFactory(<span class="string">&quot;myJpa&quot;</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EntityManager <span class="title">getEm</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> factory.createEntityManager();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="8-使用JPA完成增删改查操作"><a href="#8-使用JPA完成增删改查操作" class="headerlink" title="8.   使用JPA完成增删改查操作"></a>8.   使用JPA完成增删改查操作</h2><h3 id="1-保存"><a href="#1-保存" class="headerlink" title="1.保存"></a>1.保存</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    EntityManager em = JpaUtils.getEm();</span><br><span class="line">    EntityTransaction tx = em.getTransaction();</span><br><span class="line">    tx.begin();</span><br><span class="line">    Person person = <span class="keyword">new</span> Person(<span class="keyword">null</span>,<span class="string">&quot;aaa&quot;</span>,<span class="number">22</span>,<span class="string">&quot;aaa@163.com&quot;</span>,<span class="keyword">new</span> Date());</span><br><span class="line">    em.persist(person);</span><br><span class="line">    tx.commit();</span><br><span class="line">    em.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="2-删除"><a href="#2-删除" class="headerlink" title="2.删除"></a>2.删除</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 删除：remove</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRemove</span><span class="params">()</span></span>&#123;</span><br><span class="line">     EntityManager em = JpaUtils.getEm();</span><br><span class="line">     EntityTransaction tx = em.getTransaction();</span><br><span class="line">     tx.begin();</span><br><span class="line">     Person person = em.getReference(Person.class, <span class="number">1</span>);</span><br><span class="line">     em.remove(person);</span><br><span class="line">     tx.commit();</span><br><span class="line">     em.close();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>


<h3 id="3-更新"><a href="#3-更新" class="headerlink" title="3.更新"></a>3.更新</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新:merge</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testmerge</span><span class="params">()</span></span>&#123;</span><br><span class="line">    EntityManager em = JpaUtils.getEm();</span><br><span class="line">    EntityTransaction tx = em.getTransaction();</span><br><span class="line">    tx.begin();</span><br><span class="line">    Person person = <span class="keyword">new</span> Person(<span class="number">1</span>,<span class="string">&quot;bbb&quot;</span>,<span class="number">22</span>,<span class="string">&quot;aaa@163.com&quot;</span>,<span class="keyword">new</span> Date());</span><br><span class="line">    em.merge(person);</span><br><span class="line">    tx.commit();</span><br><span class="line">    em.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="4-根据ID查询"><a href="#4-根据ID查询" class="headerlink" title="4.根据ID查询"></a>4.根据ID查询</h3><h4 id="1）立即加载"><a href="#1）立即加载" class="headerlink" title="1）立即加载"></a>1）立即加载</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询:find</span></span><br><span class="line"><span class="comment"> * 立即加载，执行find()立刻发出sql</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFind</span><span class="params">()</span></span>&#123;</span><br><span class="line">    EntityManager em = JpaUtils.getEm();</span><br><span class="line">    Person person = em.find(Person.class, <span class="number">1</span>);</span><br><span class="line">    System.out.println(person);</span><br><span class="line">    em.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="2）懒加载"><a href="#2）懒加载" class="headerlink" title="2）懒加载"></a>2）懒加载</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询：getReference</span></span><br><span class="line"><span class="comment"> * 懒加载机制，什么时候调用查询结果什么时候发出sql语句</span></span><br><span class="line"><span class="comment"> * 得到的是一个动态代理对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testgetReference</span><span class="params">()</span></span>&#123;</span><br><span class="line">    EntityManager em = JpaUtils.getEm();</span><br><span class="line">    Person person = em.getReference(Person.class, <span class="number">1</span>);</span><br><span class="line">    System.out.println(person);</span><br><span class="line">    em.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="5-复杂查询"><a href="#5-复杂查询" class="headerlink" title="5.复杂查询"></a>5.复杂查询</h3><p>JPQL全称<code>Java Persistence Query Language</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Java持久化查询语言(JPQL)是一种可移植的查询语言，旨在以面向对象表达式语言的表达式，将SQL语法和简单查询语义绑定在一起·使用这种语言编写的查询是可移植的，可以被编译成所有主流数据库服务器上的SQL。</span></span><br><span class="line"></span><br><span class="line"><span class="attr">其特征与原生SQL语句类似，并且完全面向对象，通过类名和属性访问，而不是表名和表的属性</span></span><br></pre></td></tr></table></figure>


<h4 id="1-查询全部"><a href="#1-查询全部" class="headerlink" title="1)查询全部"></a>1)查询全部</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    EntityManager em = JpaUtils.getEm();</span><br><span class="line">    String jpql =<span class="string">&quot;from Person&quot;</span>;</span><br><span class="line">    Query query = em.createQuery(jpql);</span><br><span class="line">    query.getResultList().forEach(System.out::println);</span><br><span class="line">    em.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="2）分页查询"><a href="#2）分页查询" class="headerlink" title="2）分页查询"></a>2）分页查询</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    EntityManager em = JpaUtils.getEm();</span><br><span class="line">    String jpql =<span class="string">&quot;from Person&quot;</span>;</span><br><span class="line">    Query query = em.createQuery(jpql);</span><br><span class="line">    query.setFirstResult(<span class="number">0</span>);</span><br><span class="line">    query.setMaxResults(<span class="number">2</span>);</span><br><span class="line">    query.getResultList().forEach(System.out::println);</span><br><span class="line">    em.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="3）条件查询"><a href="#3）条件查询" class="headerlink" title="3）条件查询"></a>3）条件查询</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 条件查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    EntityManager em = JpaUtils.getEm();</span><br><span class="line">    String jpql =<span class="string">&quot;from Person where name like ?&quot;</span>;</span><br><span class="line">    Query query = em.createQuery(jpql);</span><br><span class="line">    query.setParameter(<span class="number">1</span>,<span class="string">&quot;aa%&quot;</span>);</span><br><span class="line">    <span class="comment">//获取唯一结果集</span></span><br><span class="line">    <span class="comment">//System.out.println(query.getSingleResult());</span></span><br><span class="line">    query.getResultList().forEach(System.out::println);</span><br><span class="line">    em.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="4）排序查询"><a href="#4）排序查询" class="headerlink" title="4）排序查询"></a>4）排序查询</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 排序查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    EntityManager em = JpaUtils.getEm();</span><br><span class="line">    String jpql =<span class="string">&quot;from Person order by id desc&quot;</span>;</span><br><span class="line">    Query query = em.createQuery(jpql);</span><br><span class="line">    query.getResultList().forEach(System.out::println);</span><br><span class="line">    em.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="5）统计查询"><a href="#5）统计查询" class="headerlink" title="5）统计查询"></a>5）统计查询</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统计查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    EntityManager em = JpaUtils.getEm();</span><br><span class="line">    String jpql =<span class="string">&quot;select count(id) from Person&quot;</span>;</span><br><span class="line">    Query query = em.createQuery(jpql);</span><br><span class="line">    System.out.println(query.getSingleResult());</span><br><span class="line">    em.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="二，springdatajpa的运行原理以及基本操作"><a href="#二，springdatajpa的运行原理以及基本操作" class="headerlink" title="二，springdatajpa的运行原理以及基本操作"></a>二，springdatajpa的运行原理以及基本操作</h1><h2 id="1-springDataJpa概述"><a href="#1-springDataJpa概述" class="headerlink" title="1.springDataJpa概述"></a>1.springDataJpa概述</h2><h3 id="1-1SpringDataJpa概述"><a href="#1-1SpringDataJpa概述" class="headerlink" title="1.1SpringDataJpa概述"></a>1.1SpringDataJpa概述</h3><p>Spring Data JPA 是 Spring 基于 ORM 框架、JPA 规范的基础上封装的一套JPA应用框架，可使开发者用极简的代码即可实现对数据库的访问和操作。它提供了包括增删改查等在内的常用功能，且易于扩展！学习并使用 Spring Data JPA 可以极大提高开发效率！</p>
<p>Spring Data JPA 让我们解脱了DAO层的操作，基本上所有CRUD都可以依赖于它来实现,在实际的工作工程中，推荐使用Spring Data JPA + ORM（如：hibernate）完成操作，这样在切换不同的ORM框架时提供了极大的方便，同时也使数据库层操作更加简单，方便解耦</p>
<h3 id="1-2springdatajpa的特性"><a href="#1-2springdatajpa的特性" class="headerlink" title="1.2springdatajpa的特性"></a>1.2springdatajpa的特性</h3><p>SpringData Jpa 极大简化了数据库访问层代码。 如何简化的呢？ 使用了SpringDataJpa，<strong>我们的dao层中只需要写接口</strong>，就自动具有了增删改查、分页查询等方法。</p>
<h3 id="1-3Spring-Data-JPA-与-JPA和hibernate之间的关系"><a href="#1-3Spring-Data-JPA-与-JPA和hibernate之间的关系" class="headerlink" title="1.3Spring Data JPA 与 JPA和hibernate之间的关系"></a>1.3Spring Data JPA 与 JPA和hibernate之间的关系</h3><p>JPA是一套规范，内部是有接口和抽象类组成的。hibernate是一套成熟的ORM框架，而且Hibernate实现了JPA规范，所以也可以称hibernate为JPA的一种实现方式，我们使用JPA的API编程，意味着站在更高的角度上看待问题（面向接口编程）</p>
<p>Spring Data JPA是Spring提供的一套对JPA操作更加高级的封装，是在JPA规范下的专门用来进行数据持久化的解决方案。</p>
<h2 id="2-SpringDataJpa快速入门"><a href="#2-SpringDataJpa快速入门" class="headerlink" title="2.SpringDataJpa快速入门"></a>2.SpringDataJpa快速入门</h2><h3 id="2-1需求说明"><a href="#2-1需求说明" class="headerlink" title="2.1需求说明"></a>2.1需求说明</h3><p>Spring Data JPA完成客户的基本CRUD操作</p>
<h3 id="2-2搭建环境"><a href="#2-2搭建环境" class="headerlink" title="2.2搭建环境"></a>2.2搭建环境</h3><h4 id="项目依赖"><a href="#项目依赖" class="headerlink" title="项目依赖"></a>项目依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--hibernate--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.4.15.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-entitymanager<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.7.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.6.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--springdatajpa--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.web<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="Spring整合SpringDataJPA"><a href="#Spring整合SpringDataJPA" class="headerlink" title="Spring整合SpringDataJPA"></a>Spring整合SpringDataJPA</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:jdbc</span>=<span class="string">&quot;http://www.springframework.org/schema/jdbc&quot;</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:jpa</span>=<span class="string">&quot;http://www.springframework.org/schema/data/jpa&quot;</span> <span class="attr">xmlns:task</span>=<span class="string">&quot;http://www.springframework.org/schema/task&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/data/jpa</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/data/jpa/spring-jpa.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--组件扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.example&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置要忽略的注解 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--Spring整合MyBatis--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置数据源--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引入外部属性文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.DriverName&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置事务管理器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;entityManagerFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;entityManagerFactory&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jpa:repositories</span> <span class="attr">base-package</span>=<span class="string">&quot;com.example.mapper&quot;</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">transaction-manager-ref</span>=<span class="string">&quot;transactionManager&quot;</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">entity-manager-factory-ref</span>=<span class="string">&quot;entityManagerFactory&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">jpa:repositories</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--事务管理--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;save*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;insert*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;update*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;delete*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;get*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置切入点表达式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;my&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.example.service.impl.*.* (..))&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:pointcut</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;my&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;entityManagerFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;packagesToScan&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.example.domain&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;persistenceProvider&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.hibernate.jpa.HibernatePersistenceProvider&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jpa的供应商适配器--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jpaVendorAdapter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;generateDdl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;database&quot;</span> <span class="attr">value</span>=<span class="string">&quot;MYSQL&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;databasePlatform&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.hibernate.dialect.MySQLDialect&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;showSql&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jpaDialect&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.orm.jpa.vendor.HibernateJpaDialect&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="关联映射实体类"><a href="#关联映射实体类" class="headerlink" title="关联映射实体类"></a>关联映射实体类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;t_person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = IDENTITY)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_age&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_email&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_birth&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="mapper接口"><a href="#mapper接口" class="headerlink" title="mapper接口"></a>mapper接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yinhuidong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@createTime</span> 2020-06-04-15:46</span></span><br><span class="line"><span class="comment"> * JpaRepository&lt;Person, Long&gt; 用来完成基本CRUD</span></span><br><span class="line"><span class="comment"> * JpaSpecificationExecutor&lt;Person&gt; 用来完成复杂查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonMapper</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Person</span>, <span class="title">Long</span>&gt;, <span class="title">JpaSpecificationExecutor</span>&lt;<span class="title">Person</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCRUD</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PersonMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//保存操作</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mapper.save(<span class="keyword">new</span> Person(<span class="string">&quot;aaa&quot;</span>,<span class="number">20</span>,<span class="string">&quot;aaa@qq.com&quot;</span>,<span class="keyword">new</span> Date()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改操作：</span></span><br><span class="line"><span class="comment">     * 修改与保存共用一个方法save</span></span><br><span class="line"><span class="comment">     * 当传入的实体类有主键就是修改，没有主键就是保存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Person person = <span class="keyword">new</span> Person(<span class="string">&quot;aaa&quot;</span>,<span class="number">20</span>,<span class="string">&quot;bbb@qq.com&quot;</span>,<span class="keyword">new</span> Date());</span><br><span class="line">        person.setId(<span class="number">8l</span>);</span><br><span class="line">        mapper.save(person);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//删除</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Person person = <span class="keyword">new</span> Person(<span class="string">&quot;aaa&quot;</span>,<span class="number">20</span>,<span class="string">&quot;bbb@qq.com&quot;</span>,<span class="keyword">new</span> Date());</span><br><span class="line">        person.setId(<span class="number">8l</span>);</span><br><span class="line">        mapper.delete(person);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//根据ID查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(mapper.findById(<span class="number">7l</span>).get());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//查询所有</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mapper.findAll().forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="3-SpringDataJPA的底层代码分析"><a href="#3-SpringDataJPA的底层代码分析" class="headerlink" title="3.SpringDataJPA的底层代码分析"></a>3.SpringDataJPA的底层代码分析</h2><h3 id="3-1常用接口分析"><a href="#3-1常用接口分析" class="headerlink" title="3.1常用接口分析"></a>3.1常用接口分析</h3><p>在自定义mapper接口中，并没有提供任何方法就可以使用其中的方法，那么这些方法究竟是怎么来的？，由于我们的接口继承了<code>JpaRepository</code>和<code>JpaSpecificationExecutor</code>，所以我们可以使用这两个接口的所有方法。</p>
<p>在使用<code>Spring Data JPA</code>时，一般实现<code>JpaRepository</code>和<code>JpaSpecificationExecutor</code>接口，这样就可以使用这些接口中定义的方法，但是这些方法都只是一些声明，没有具体的实现方式，那么在 <code>Spring Data JPA</code>中它又是怎么实现的呢？</p>
<h3 id="3-2SpringDataJPA的实现过程"><a href="#3-2SpringDataJPA的实现过程" class="headerlink" title="3.2SpringDataJPA的实现过程"></a>3.2SpringDataJPA的实现过程</h3><p>通过刚才的入门案例，打断点来分析SpringDataJPA的执行过程。</p>
<p>以findById（）为例。</p>
<p><img src="https://img-blog.csdnimg.cn/20200909225442230.jpg#pic_center#id=O9jM0&originHeight=118&originWidth=890&originalType=binary&ratio=1&status=done&style=none"></p>
<p>断点执行到方法上时，我们可以发现注入的是personmapper对象，本质上是通过jdk的动态代理生成的一个对象。</p>
<p>查看具体过程：</p>
<p><img src="https://img-blog.csdnimg.cn/20200909225456191.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTU5NjAyMg==,size_16,color_FFFFFF,t_70#pic_center#id=JVr9R&originHeight=570&originWidth=1736&originalType=binary&ratio=1&status=done&style=none"></p>
<p><img src="https://img-blog.csdnimg.cn/20200909225509872.jpg#pic_center#id=Azqxn&originHeight=174&originWidth=631&originalType=binary&ratio=1&status=done&style=none"></p>
<p>当程序执行的时候，会通过<code>JdkDynamicAopProxy</code>的<code>invoke</code>方法，对<code>Dao</code>对象生成动态代理对象。根据对<code>Spring Data JPA</code>介绍而知，要想进行<code>findOne</code>查询方法，最终还是会出现JPA规范的API完成操作，那么这些底层代码存在于何处呢？答案很简单，都隐藏在通过<code>JdkDynamicAopProxy</code>生成的动态代理对象当中，而这个动态代理对象就是<code>SimpleJpaRepository</code>,通过    <code>SimpleJpaRepository</code>的源码分析，定位到了<code>findOne</code>方法，在此方法中，返回<code>em.find()</code>的返回结果，那么em又是什么呢？</p>
<p>继续查找em对象，我们发现<code>em</code>就是<code>EntityManager</code>对象，而他是<code>JPA</code>原生的实现方式，所以我们得到结论<code>Spring Data JPA</code>只是对标准JPA操作进行了进一步封装，简化了<code>Dao</code>层代码的开发。</p>
<p>由此可得：SpringDataJpa完整执行流程：</p>
<p><strong>SpringDataJpa–&gt;JPA–&gt;hibernate–&gt;数据库</strong></p>
<h2 id="4-SpringDataJPA的查询方式"><a href="#4-SpringDataJPA的查询方式" class="headerlink" title="4.SpringDataJPA的查询方式"></a>4.SpringDataJPA的查询方式</h2><h3 id="4-1使用jpql的方式查询"><a href="#4-1使用jpql的方式查询" class="headerlink" title="4.1使用jpql的方式查询"></a>4.1使用jpql的方式查询</h3><p>使用Spring Data JPA提供的查询方法已经可以解决大部分的应用场景，但是对于某些业务来说，我们还需要灵活的构造查询条件，这时就可以使用@Query注解，结合JPQL的语句方式完成查询</p>
<p><a href="/Query">**@Query **</a>** 注解的使用非常简单，只需在方法上面标注该注解，同时提供一个JPQL查询语句即可 **</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试使用JPQL的方式进行查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Query(&quot;from Person &quot;)</span></span><br><span class="line"><span class="function">List&lt;Person&gt; <span class="title">MyfindAll</span><span class="params">()</span></span>;</span><br><span class="line"><span class="meta">@Query(&quot;from Person where id=?1&quot;)</span></span><br><span class="line"><span class="function">Person <span class="title">MyfindById</span><span class="params">(Long id)</span></span>;</span><br><span class="line"><span class="meta">@Query(value = &quot;update Person set name=?1 where id=?2&quot;)</span></span><br><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MyUpdate</span><span class="params">(String name,Long id)</span></span>;</span><br></pre></td></tr></table></figure>


<h3 id="4-2使用SQL语句查询"><a href="#4-2使用SQL语句查询" class="headerlink" title="4.2使用SQL语句查询"></a>4.2使用SQL语句查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * nativeQuery : 使用本地sql的方式查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Query(value = &quot;select * from t_person&quot;,nativeQuery = true)</span></span><br><span class="line"><span class="function">List&lt;Person&gt; <span class="title">MyfindAll</span><span class="params">()</span></span>;</span><br><span class="line"><span class="meta">@Query(value = &quot;select * from t_person where id=?1&quot;,nativeQuery = true)</span></span><br><span class="line"><span class="function">Person <span class="title">MyfindById</span><span class="params">(Long id)</span></span>;</span><br><span class="line"><span class="meta">@Query(value = &quot;update t_person set p_name=?1 where id=?2&quot;,nativeQuery = true)</span></span><br><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MyUpdate</span><span class="params">(String name,Long id)</span></span>;</span><br></pre></td></tr></table></figure>


<h3 id="4-3方法命名规则查询"><a href="#4-3方法命名规则查询" class="headerlink" title="4.3方法命名规则查询"></a>4.3方法命名规则查询</h3><p>方法命名规则查询就是根据方法的名字，就能创建查询。只需要按照Spring Data JPA提供的方法命名规则定义方法的名称，就可以完成查询工作。Spring Data JPA在程序执行的时候会根据方法名称进行解析，并自动生成查询语句进行查询</p>
<p>按照Spring Data JPA 定义的规则，查询方法以findBy开头，涉及条件查询时，条件的属性用条件关键字连接，要注意的是：条件属性首字母需大写。框架在进行方法名解析时，会先把方法名多余的前缀截取掉，然后对剩下部分进行解析。</p>
<table>
<thead>
<tr>
<th><strong>Keyword</strong></th>
<th><strong>Sample</strong></th>
<th><strong>JPQL</strong></th>
</tr>
</thead>
<tbody><tr>
<td>And</td>
<td>findByLastnameAndFirstname</td>
<td>…  where x.lastname = ?1 and x.firstname = ?2</td>
</tr>
<tr>
<td>Or</td>
<td>findByLastnameOrFirstname</td>
<td>…  where x.lastname = ?1 or x.firstname = ?2</td>
</tr>
<tr>
<td>Is,Equals</td>
<td>findByFirstnameIs,  findByFirstnameEquals</td>
<td>…  where x.firstname = ?1</td>
</tr>
<tr>
<td>Between</td>
<td>findByStartDateBetween</td>
<td>…  where x.startDate between ?1 and ?2</td>
</tr>
<tr>
<td>LessThan</td>
<td>findByAgeLessThan</td>
<td>…  where x.age &lt; ?1</td>
</tr>
<tr>
<td>LessThanEqual</td>
<td>findByAgeLessThanEqual</td>
<td>…  where x.age ⇐ ?1</td>
</tr>
<tr>
<td>GreaterThan</td>
<td>findByAgeGreaterThan</td>
<td>…  where x.age &gt; ?1</td>
</tr>
<tr>
<td>GreaterThanEqual</td>
<td>findByAgeGreaterThanEqual</td>
<td>…  where x.age &gt;= ?1</td>
</tr>
<tr>
<td>After</td>
<td>findByStartDateAfter</td>
<td>…  where x.startDate &gt; ?1</td>
</tr>
<tr>
<td>Before</td>
<td>findByStartDateBefore</td>
<td>…  where x.startDate &lt; ?1</td>
</tr>
<tr>
<td>IsNull</td>
<td>findByAgeIsNull</td>
<td>…  where x.age is null</td>
</tr>
<tr>
<td>IsNotNull,NotNull</td>
<td>findByAge(Is)NotNull</td>
<td>…  where x.age not null</td>
</tr>
<tr>
<td>Like</td>
<td>findByFirstnameLike</td>
<td>…  where x.firstname like ?1</td>
</tr>
<tr>
<td>NotLike</td>
<td>findByFirstnameNotLike</td>
<td>… where  x.firstname not like ?1</td>
</tr>
<tr>
<td>StartingWith</td>
<td>findByFirstnameStartingWith</td>
<td>…  where x.firstname like ?1 (parameter bound with appended %)</td>
</tr>
<tr>
<td>EndingWith</td>
<td>findByFirstnameEndingWith</td>
<td>…  where x.firstname like ?1 (parameter bound with prepended %)</td>
</tr>
<tr>
<td>Containing</td>
<td>findByFirstnameContaining</td>
<td>…  where x.firstname like ?1 (parameter bound wrapped in %)</td>
</tr>
<tr>
<td>OrderBy</td>
<td>findByAgeOrderByLastnameDesc</td>
<td>…  where x.age = ?1 order by x.lastname desc</td>
</tr>
<tr>
<td>Not</td>
<td>findByLastnameNot</td>
<td>…  where x.lastname &lt;&gt; ?1</td>
</tr>
<tr>
<td>In</td>
<td>findByAgeIn(Collection ages)</td>
<td>…  where x.age in ?1</td>
</tr>
<tr>
<td>NotIn</td>
<td>findByAgeNotIn(Collection age)</td>
<td>…  where x.age not in ?1</td>
</tr>
<tr>
<td>TRUE</td>
<td>findByActiveTrue()</td>
<td>…  where x.active = true</td>
</tr>
<tr>
<td>FALSE</td>
<td>findByActiveFalse()</td>
<td>…  where x.active = false</td>
</tr>
<tr>
<td>IgnoreCase</td>
<td>findByFirstnameIgnoreCase</td>
<td>…  where UPPER(x.firstame) = UPPER(?1)</td>
</tr>
</tbody></table>
<h1 id="三，springdataJpa的动态查询与多表查询"><a href="#三，springdataJpa的动态查询与多表查询" class="headerlink" title="三，springdataJpa的动态查询与多表查询"></a>三，springdataJpa的动态查询与多表查询</h1><h2 id="1-动态查询"><a href="#1-动态查询" class="headerlink" title="1.动态查询"></a>1.动态查询</h2><p>有时我们在查询某个实体的时候，给定的条件是不固定的，这时就需要动态构建相应的查询语句，在Spring Data JPA中可以通过JpaSpecificationExecutor接口查询。相比JPQL,其优势是类型安全,更加的面向对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Page;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Pageable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Sort;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.domain.Specification;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	JpaSpecificationExecutor中定义的方法</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">JpaSpecificationExecutor</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">   	<span class="comment">//根据条件查询一个对象</span></span><br><span class="line"> 	<span class="function">T <span class="title">findOne</span><span class="params">(Specification&lt;T&gt; spec)</span></span>;	</span><br><span class="line">   	<span class="comment">//根据条件查询集合</span></span><br><span class="line"> 	<span class="function">List&lt;T&gt; <span class="title">findAll</span><span class="params">(Specification&lt;T&gt; spec)</span></span>;</span><br><span class="line">   	<span class="comment">//根据条件分页查询</span></span><br><span class="line"> 	<span class="function">Page&lt;T&gt; <span class="title">findAll</span><span class="params">(Specification&lt;T&gt; spec, Pageable pageable)</span></span>;</span><br><span class="line">   	<span class="comment">//排序查询查询</span></span><br><span class="line"> 	<span class="function">List&lt;T&gt; <span class="title">findAll</span><span class="params">(Specification&lt;T&gt; spec, Sort sort)</span></span>;</span><br><span class="line">   	<span class="comment">//统计查询</span></span><br><span class="line"> 	<span class="function"><span class="keyword">long</span> <span class="title">count</span><span class="params">(Specification&lt;T&gt; spec)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>对于JpaSpecificationExecutor，这个接口基本是围绕着Specification接口来定义的。我们可以简单的理解为，Specification构造的就是查询条件。</p>
<p><strong>Specification接口中只定义了如下一个方法：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构造查询条件</span></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">   *	root	：Root接口，代表查询的根对象，可以通过root获取实体中的属性</span></span><br><span class="line"><span class="comment">   *	query	：代表一个顶层查询对象，用来自定义查询</span></span><br><span class="line"><span class="comment">   *	cb		：用来构建查询，此对象里有很多条件方法</span></span><br><span class="line"><span class="comment">   **/</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;T&gt; root, CriteriaQuery&lt;?&gt; query, CriteriaBuilder cb)</span></span>;</span><br></pre></td></tr></table></figure>


<h3 id="1-1-使用Specifications完成条件查询"><a href="#1-1-使用Specifications完成条件查询" class="headerlink" title="1.1  使用Specifications完成条件查询"></a>1.1  使用Specifications完成条件查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//动态条件查询</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test7</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//使用匿名了内部类的方式，创建一个Specification的实现类，并实现toPredicate（）</span></span><br><span class="line">    Specification&lt;Person&gt; sp=<span class="keyword">new</span> Specification&lt;Person&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Person&gt; root, CriteriaQuery&lt;?&gt; criteriaQuery, CriteriaBuilder criteriaBuilder)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//criteriaBuilder:构建查询，添加查询方式 like：模糊匹配</span></span><br><span class="line">            <span class="keyword">return</span> criteriaBuilder.like(root.get(<span class="string">&quot;name&quot;</span>).as(String.class),<span class="string">&quot;少妇白洁&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    mapper.findAll(sp).forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="1-2基于Specification的分页查询"><a href="#1-2基于Specification的分页查询" class="headerlink" title="1.2基于Specification的分页查询"></a>1.2基于Specification的分页查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//动态分页查询</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test8</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//构建查询条件</span></span><br><span class="line">    Specification&lt;Person&gt; sp=<span class="keyword">new</span> Specification&lt;Person&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Predicate <span class="title">toPredicate</span><span class="params">(Root&lt;Person&gt; root, CriteriaQuery&lt;?&gt; criteriaQuery, CriteriaBuilder criteriaBuilder)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> criteriaBuilder.like(root.get(<span class="string">&quot;name&quot;</span>).as(String.class),<span class="string">&quot;少妇%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构建分页参数：</span></span><br><span class="line"><span class="comment">     *  Pageable：接口</span></span><br><span class="line"><span class="comment">     *  PageRequet实现了Pageable接口，调用of方法的形式构造。</span></span><br><span class="line"><span class="comment">     *      第一个参数：页码（从0开始）</span></span><br><span class="line"><span class="comment">     *      第二个参数：每页查询条数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Pageable request = PageRequest.of(<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询：封装为SpringDataJpa内部的pageBean</span></span><br><span class="line"><span class="comment">     * 此重载findAlll方法为分页方法需要两个参数</span></span><br><span class="line"><span class="comment">     *      第一个参数、；查询条件</span></span><br><span class="line"><span class="comment">     *      第二个参数：分页参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Page&lt;Person&gt; page = mapper.findAll(sp, request);</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="1-3方法对应关系"><a href="#1-3方法对应关系" class="headerlink" title="1.3方法对应关系"></a>1.3方法对应关系</h3><table>
<thead>
<tr>
<th>方法名称</th>
<th>Sql对应关系</th>
</tr>
</thead>
<tbody><tr>
<td>equle</td>
<td>filed =  value</td>
</tr>
<tr>
<td>gt（greaterThan ）</td>
<td>filed  &gt; value</td>
</tr>
<tr>
<td>lt（lessThan ）</td>
<td>filed  &lt; value</td>
</tr>
<tr>
<td>ge（greaterThanOrEqualTo ）</td>
<td>filed  &gt;= value</td>
</tr>
<tr>
<td>le（ lessThanOrEqualTo）</td>
<td>filed  &lt;= value</td>
</tr>
<tr>
<td>notEqule</td>
<td>filed  != value</td>
</tr>
<tr>
<td>like</td>
<td>filed  like value</td>
</tr>
<tr>
<td>notLike</td>
<td>filed  not like value</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="2-多表设计"><a href="#2-多表设计" class="headerlink" title="2.多表设计"></a>2.多表设计</h2><h3 id="2-1表之间关系的划分"><a href="#2-1表之间关系的划分" class="headerlink" title="2.1表之间关系的划分"></a>2.1表之间关系的划分</h3><p>数据库中多表之间存在着三种关系，如图所示。</p>
<p><img src="https://img-blog.csdnimg.cn/20200909225544612.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTU5NjAyMg==,size_16,color_FFFFFF,t_70#pic_center#id=AdWAs&originHeight=343&originWidth=600&originalType=binary&ratio=1&status=done&style=none"></p>
<p>从图可以看出，系统设计的三种实体关系分别为：多对多、一对多和一对一关系。注意：一对多关系可以看为两种： 即一对多，多对一。所以说四种更精确。</p>
<h3 id="2-2-在JPA框架中表关系的分析步骤"><a href="#2-2-在JPA框架中表关系的分析步骤" class="headerlink" title="2.2  在JPA框架中表关系的分析步骤"></a>2.2  在JPA框架中表关系的分析步骤</h3><p>在实际开发中，我们数据库的表难免会有相互的关联关系，在操作表的时候就有可能会涉及到多张表的操作。而在这种实现了ORM思想的框架中（如JPA），可以让我们通过操作实体类就实现对数据库表的操作。所以学习重点是：掌握配置实体之间的关联关系。</p>
<p><strong>第一步：首先确定两张表之间的关系。</strong></p>
<pre><code>如果关系确定错了，后面做的所有操作就都不可能正确。
</code></pre>
<p><strong>第二步：在数据库中实现两张表的关系</strong></p>
<p><strong>第三步：在实体类中描述出两个实体的关系</strong></p>
<p><strong>第四步：配置出实体类和数据库表的关系映射（重点）</strong></p>
<h2 id="3-jpa中的一对多"><a href="#3-jpa中的一对多" class="headerlink" title="3.jpa中的一对多"></a>3.jpa中的一对多</h2><h3 id="3-1情景模拟"><a href="#3-1情景模拟" class="headerlink" title="3.1情景模拟"></a>3.1情景模拟</h3><p>上个案例我创建的是一张Person表，此时在创建一张Dog表，每个人都可以对应着多个宠物狗。</p>
<p>此时从人的角度就是一对多的关系。</p>
<h3 id="3-2表关系建立"><a href="#3-2表关系建立" class="headerlink" title="3.2表关系建立"></a>3.2表关系建立</h3><p>在一对多关系中，我们习惯把一的一方称之为主表，把多的一方称之为从表。在数据库中建立一对多的关系，需要使用数据库的外键约束。</p>
<p>什么是外键？</p>
<p>指的是从表中有一列，取值参照主表的主键，这一列就是外键。</p>
<p>一对多数据库关系的建立，如下图所示</p>
<p><img src="https://img-blog.csdnimg.cn/20200909225601721.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTU5NjAyMg==,size_16,color_FFFFFF,t_70#pic_center#id=WHW2k&originHeight=313&originWidth=876&originalType=binary&ratio=1&status=done&style=none"></p>
<h3 id="3-3-实体类关系建立以及映射配置"><a href="#3-3-实体类关系建立以及映射配置" class="headerlink" title="3.3  实体类关系建立以及映射配置"></a>3.3  实体类关系建立以及映射配置</h3><p>数据库建表语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t_person(</span><br><span class="line">id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">p_age INT ,</span><br><span class="line">p_birth DATE,</span><br><span class="line">p_email VARCHAR(20),</span><br><span class="line">p_name VARCHAR(20)</span><br><span class="line">);</span><br><span class="line">CREATE TABLE t_dog(</span><br><span class="line">d_id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">d_name VARCHAR(20),</span><br><span class="line">p_id INT REFERENCES t_person(id) </span><br><span class="line">);</span><br></pre></td></tr></table></figure>


<p>实体类关系映射</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;t_person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = IDENTITY)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_age&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_email&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_birth&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="meta">@OneToMany(mappedBy=&quot;person&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Dog&gt; dogs=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;t_dog&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;d_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@Column(name = &quot;d_name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@ManyToOne(targetEntity = Person.class)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;p_id&quot;,referencedColumnName = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Person person;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="3-4映射的注解说明"><a href="#3-4映射的注解说明" class="headerlink" title="3.4映射的注解说明"></a>3.4映射的注解说明</h3><h4 id="OneToMany"><a href="#OneToMany" class="headerlink" title="@OneToMany:"></a><strong>@OneToMany:</strong></h4><p>作用：建立一对多的关系映射</p>
<p>属性：</p>
<p>       targetEntityClass：指定多的多方的类的字节码</p>
<p>       mappedBy：指定从表实体类中引用主表对象的名称。</p>
<p>       cascade：指定要使用的级联操作</p>
<p>       fetch：指定是否采用延迟加载</p>
<p>       orphanRemoval：是否使用孤儿删除</p>
<h4 id="ManyToOne"><a href="#ManyToOne" class="headerlink" title="**@ManyToOne **** **"></a><a href="/ManyToOne">**@ManyToOne **</a>** **</h4><p>作用：建立多对一的关系</p>
<p>属性：</p>
<p>       targetEntityClass：指定一的一方实体类字节码</p>
<p>       cascade：指定要使用的级联操作</p>
<p>       fetch：指定是否采用延迟加载</p>
<p>       optional：关联是否可选。如果设置为false，则必须始终存在非空关系。</p>
<h4 id="JoinColumn"><a href="#JoinColumn" class="headerlink" title="**@JoinColumn **** **"></a><a href="/JoinColumn">**@JoinColumn **</a>** **</h4><p>作用：用于定义主键字段和外键字段的对应关系。</p>
<p>属性：</p>
<p>       name：指定外键字段的名称</p>
<p>       referencedColumnName：指定引用主表的主键字段名称</p>
<p>       unique：是否唯一。默认值不唯一</p>
<p>       nullable：是否允许为空。默认值允许。</p>
<p>       insertable：是否允许插入。默认值允许。</p>
<p>       updatable：是否允许更新。默认值允许。</p>
<p>       columnDefinition：列的定义信息。</p>
<h3 id="3-5一对多的操作"><a href="#3-5一对多的操作" class="headerlink" title="3.5一对多的操作"></a>3.5一对多的操作</h3><h4 id="1）添加"><a href="#1）添加" class="headerlink" title="1）添加"></a>1）添加</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OneToManyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PersonMapper personMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DogMapper dogMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试保存：</span></span><br><span class="line"><span class="comment">     *      同时保存一个狗主人和一只狗的信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Rollback(value = false)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Person person = <span class="keyword">new</span> Person(<span class="string">&quot;张敏&quot;</span>,<span class="number">26</span>,<span class="string">&quot;baijie@qq.com&quot;</span>,<span class="keyword">new</span> Date());</span><br><span class="line">        Dog dog = <span class="keyword">new</span> Dog();</span><br><span class="line">        dog.setName(<span class="string">&quot;金毛&quot;</span>);</span><br><span class="line">        person.getDogs().add(dog);</span><br><span class="line">        dog.setPerson(person);</span><br><span class="line">        personMapper.save(person);</span><br><span class="line">        dogMapper.save(dog);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="2）删除"><a href="#2）删除" class="headerlink" title="2）删除"></a>2）删除</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//删除主表数据，可以直接删除，对应从表外键字段还是删除的主表ID</span></span><br><span class="line">    personMapper.deleteById(<span class="number">4l</span>);</span><br><span class="line">    <span class="comment">//此时在删除从表会报错</span></span><br><span class="line">    dogMapper.deleteById(<span class="number">4l</span>);</span><br><span class="line">    <span class="comment">//如果先删除从表再删除主表则没有问题</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="3）级联操作"><a href="#3）级联操作" class="headerlink" title="3）级联操作"></a>3）级联操作</h4><p>级联操作：指操作一个对象同时操作它的关联对象</p>
<p>使用方法：只需要在操作主体的注解上配置cascade</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@OneToMany(mappedBy=&quot;person&quot;,cascade = CascadeType.ALL)</span><br></pre></td></tr></table></figure>


<p><strong>cascade:配置级联操作</strong><br><code>CascadeType.MERGE</code>    级联更新<br><code>CascadeType.PERSIST</code>    级联保存：<br><code>CascadeType.REFRESH</code> 级联刷新：<br><code>CascadeType.REMOVE</code>    级联删除：<br><code>CascadeType.ALL</code>        包含所有</p>
<h2 id="4-jpa中的多对多"><a href="#4-jpa中的多对多" class="headerlink" title="4.jpa中的多对多"></a>4.jpa中的多对多</h2><h3 id="4-1-情景模拟"><a href="#4-1-情景模拟" class="headerlink" title="4.1.情景模拟"></a>4.1.情景模拟</h3><p>用户和角色：一个用户可以有多个角色，一个角色可以对应多个用户</p>
<h3 id="4-2表关系建立"><a href="#4-2表关系建立" class="headerlink" title="4.2表关系建立"></a>4.2表关系建立</h3><p><img src="https://img-blog.csdnimg.cn/20200909225627238.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTU5NjAyMg==,size_16,color_FFFFFF,t_70#pic_center#id=nC88o&originHeight=375&originWidth=1286&originalType=binary&ratio=1&status=done&style=none"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t_role(</span><br><span class="line">r_id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">NAME VARCHAR(20)</span><br><span class="line">);</span><br><span class="line">CREATE TABLE t_person_role(</span><br><span class="line">id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">r_id INT REFERENCES t_role(r_id),</span><br><span class="line">p_id INT REFERENCES t_person(id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>


<h3 id="4-3实体关系建立以及映射配置"><a href="#4-3实体关系建立以及映射配置" class="headerlink" title="4.3实体关系建立以及映射配置"></a>4.3实体关系建立以及映射配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;t_person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = IDENTITY)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_age&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_email&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="meta">@Column(name = &quot;p_birth&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">    <span class="meta">@OneToMany(mappedBy=&quot;person&quot;,cascade = CascadeType.ALL)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Dog&gt; dogs=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="comment">//多对多关系映射</span></span><br><span class="line">    <span class="meta">@ManyToMany(mappedBy =&quot;persons&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Role&gt; roles=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;t_role&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;r_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="meta">@Column(name = &quot;name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@ManyToMany</span></span><br><span class="line">    <span class="meta">@JoinTable(name=&quot;t_person_role&quot;,//中间表的名称</span></span><br><span class="line"><span class="meta">            joinColumns=&#123;@JoinColumn(name=&quot;r_id&quot;,referencedColumnName=&quot;r_id&quot;)&#125;,</span></span><br><span class="line"><span class="meta">            inverseJoinColumns=&#123;@JoinColumn(name=&quot;p_id&quot;,referencedColumnName=&quot;id&quot;)&#125;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Person&gt; persons=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<h3 id="4-4映射的注解说明"><a href="#4-4映射的注解说明" class="headerlink" title="4.4映射的注解说明"></a>4.4映射的注解说明</h3><h4 id="ManyToMany"><a href="#ManyToMany" class="headerlink" title="**@ManyToMany **** **"></a><a href="/ManyToMany">**@ManyToMany **</a>** **</h4><p>     作用：用于映射多对多关系</p>
<p>     属性：</p>
<p>         cascade：配置级联操作。</p>
<p>         fetch：配置是否采用延迟加载。</p>
<p>       targetEntity：配置目标的实体类。映射多对多的时候不用写。</p>
<h4 id="JoinTable"><a href="#JoinTable" class="headerlink" title="**@JoinTable **** **"></a><a href="/JoinTable">**@JoinTable **</a>** **</h4><p>作用：针对中间表的配置</p>
<p>属性：</p>
<p>       nam：配置中间表的名称</p>
<p>       joinColumns：中间表的外键字段关联当前实体类所对应表的主键字段</p>
<p>       inverseJoinColumn：中间表的外键字段关联对方表的主键字段</p>
<p>​</p>
<h4 id="JoinColumn-1"><a href="#JoinColumn-1" class="headerlink" title="**@JoinColumn **** **"></a><a href="/JoinColumn">**@JoinColumn **</a>** **</h4><p>作用：用于定义主键字段和外键字段的对应关系。</p>
<p>属性：</p>
<p>       name：指定外键字段的名称</p>
<p>       referencedColumnName：指定引用主表的主键字段名称</p>
<p>       unique：是否唯一。默认值不唯一</p>
<p>       nullable：是否允许为空。默认值允许。</p>
<p>       insertable：是否允许插入。默认值允许。</p>
<p>       updatable：是否允许更新。默认值允许。</p>
<p>       columnDefinition：列的定义信息。</p>
<h3 id="4-5多对多的操作"><a href="#4-5多对多的操作" class="headerlink" title="4.5多对多的操作"></a>4.5多对多的操作</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yinhuidong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@createTime</span> 2020-06-04-21:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ManyToManyTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PersonMapper personMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RoleMapper roleMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Rollback(false)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Person person = <span class="keyword">new</span> Person();</span><br><span class="line">        person.setName(<span class="string">&quot;尹会东&quot;</span>);</span><br><span class="line">        Person person2 = <span class="keyword">new</span> Person();</span><br><span class="line">        person2.setName(<span class="string">&quot;张贝贝&quot;</span>);</span><br><span class="line">        Role r1 = <span class="keyword">new</span> Role();</span><br><span class="line">        r1.setName(<span class="string">&quot;学生&quot;</span>);</span><br><span class="line">        Role r2 = <span class="keyword">new</span> Role();</span><br><span class="line">        r2.setName(<span class="string">&quot;丈夫&quot;</span>);</span><br><span class="line">        person.getRoles().add(r1);</span><br><span class="line">        person.getRoles().add(r2);</span><br><span class="line">        person2.getRoles().add(r1);</span><br><span class="line">        person2.getRoles().add(r2);</span><br><span class="line">        r1.getPersons().add(person);</span><br><span class="line">        r2.getPersons().add(person);</span><br><span class="line">        r1.getPersons().add(person2);</span><br><span class="line">        r2.getPersons().add(person2);</span><br><span class="line">        personMapper.save(person);</span><br><span class="line">        personMapper.save(person2);</span><br><span class="line">        roleMapper.save(r1);</span><br><span class="line">        roleMapper.save(r2);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Rollback(false)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        personMapper.deleteById(<span class="number">10l</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="5-SpringDataJPA的多表查询"><a href="#5-SpringDataJPA的多表查询" class="headerlink" title="5.SpringDataJPA的多表查询"></a>5.SpringDataJPA的多表查询</h2><h3 id="对象导航图查询"><a href="#对象导航图查询" class="headerlink" title="对象导航图查询"></a>对象导航图查询</h3><p>对象图导航检索方式是根据已经加载的对象，导航到他的关联对象。它利用类与类之间的关系来检索对象。例如：我们通过ID查询方式查出一个客户，可以调用Customer类中的getLinkMans()方法来获取该客户的所有联系人。对象导航查询的使用要求是：两个对象之间必须存在关联关系。</p>
<p><strong>查询一个Person获取它对应的所有Role</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Person person = personMapper.findById(<span class="number">11l</span>).get();</span><br><span class="line">    System.out.println(<span class="string">&quot;person = &quot;</span> + person);</span><br><span class="line">    person.getRoles().forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong>查询一个角色，获取角色对应的所有person</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Role role = roleMapper.findById(<span class="number">5l</span>).get();</span><br><span class="line">    System.out.println(<span class="string">&quot;role = &quot;</span> + role);</span><br><span class="line">    role.getPersons().forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>对象导航查询的问题分析</p>
<p><strong>问题1</strong>：我们查询客户时，要不要把联系人查询出来？</p>
<p>分析：如果我们不查的话，在用的时候还要自己写代码，调用方法去查询。如果我们查出来的，不使用时又会白白的浪费了服务器内存。</p>
<p>解决：采用延迟加载的思想。通过配置的方式来设定当我们在需要使用时，发起真正的查询。</p>
<p>配置方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//LAZY</span><br><span class="line">    @ManyToMany(mappedBy =&quot;persons&quot;,fetch = FetchType.EAGER)</span><br></pre></td></tr></table></figure>


<p><code>FetchType.EAGER</code>  立即加载</p>
<p><code>FetchType.LAZY</code>  懒加载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">    r1.getPersons().add(person);</span><br><span class="line">    r2.getPersons().add(person);</span><br><span class="line">    r1.getPersons().add(person2);</span><br><span class="line">    r2.getPersons().add(person2);</span><br><span class="line">    personMapper.save(person);</span><br><span class="line">    personMapper.save(person2);</span><br><span class="line">    roleMapper.save(r1);</span><br><span class="line">    roleMapper.save(r2);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">@Test</span><br><span class="line">@Transactional</span><br><span class="line">@Rollback(false)</span><br><span class="line">public void test2()&#123;</span><br><span class="line">    personMapper.deleteById(10l);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 5.SpringDataJPA的多表查询</span><br><span class="line"></span><br><span class="line">### 5.1对象导航图查询</span><br><span class="line"></span><br><span class="line">对象图导航检索方式是根据已经加载的对象，导航到他的关联对象。它利用类与类之间的关系来检索对象。例如：我们通过ID查询方式查出一个客户，可以调用Customer类中的getLinkMans()方法来获取该客户的所有联系人。对象导航查询的使用要求是：两个对象之间必须存在关联关系。</span><br><span class="line"></span><br><span class="line">**查询一个Person获取它对应的所有Role**</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">    @Transactional</span><br><span class="line">    @Test</span><br><span class="line">    public void test3()&#123;</span><br><span class="line">        Person person = personMapper.findById(11l).get();</span><br><span class="line">        System.out.println(&quot;person = &quot; + person);</span><br><span class="line">        person.getRoles().forEach(System.out::println);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<p><strong>查询一个角色，获取角色对应的所有person</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Role role = roleMapper.findById(<span class="number">5l</span>).get();</span><br><span class="line">    System.out.println(<span class="string">&quot;role = &quot;</span> + role);</span><br><span class="line">    role.getPersons().forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>对象导航查询的问题分析</p>
<p><strong>问题1</strong>：我们查询客户时，要不要把联系人查询出来？</p>
<p>分析：如果我们不查的话，在用的时候还要自己写代码，调用方法去查询。如果我们查出来的，不使用时又会白白的浪费了服务器内存。</p>
<p>解决：采用延迟加载的思想。通过配置的方式来设定当我们在需要使用时，发起真正的查询。</p>
<p>配置方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//LAZY</span><br><span class="line">    @ManyToMany(mappedBy =&quot;persons&quot;,fetch = FetchType.EAGER)</span><br></pre></td></tr></table></figure>


<p><code>FetchType.EAGER</code>  立即加载</p>
<p><code>FetchType.LAZY</code>  懒加载</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">二十</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://yinhuidong.github.io/2022/01/11/MyBatis/Spring%20Data%20Jpa%E4%BD%BF%E7%94%A8%E7%AF%87/">https://yinhuidong.github.io/2022/01/11/MyBatis/Spring Data Jpa使用篇/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://yinhuidong.github.io" target="_blank">二十</a> 许可协议。转载请注明来自 <a href="https://yinhuidong.github.io" target="_blank">二十</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MyBatis/">MyBatis</a></div><div class="post_share"><div class="social-share" data-image="/images/cover/MyBatis.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat_pay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat_pay.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/01/11/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/RabbitMQ/"><img class="prev-cover" src="/images/cover/mq.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">RabbitMQ</div></div></a></div><div class="next-post pull-right"><a href="/2022/01/11/MyBatis/MyBatis%E5%BA%94%E7%94%A8%E5%88%86%E6%9E%90%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"><img class="next-cover" src="/images/cover/MyBatis.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MyBatis应用分析与最佳实践</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/01/11/MyBatis/MyBatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="MyBatis源码分析"><img class="cover" src="/images/cover/MyBatis.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-11</div><div class="title">MyBatis源码分析</div></div></a></div><div><a href="/2022/01/11/MyBatis/MyBatis%E5%BA%94%E7%94%A8%E5%88%86%E6%9E%90%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" title="MyBatis应用分析与最佳实践"><img class="cover" src="/images/cover/MyBatis.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-11</div><div class="title">MyBatis应用分析与最佳实践</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">二十</div><div class="author-info__description">欢迎来到二十的博客....</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">118</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/yinhuidong"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/yinhuidong" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1972039773@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">欢迎来到二十的个人博客，联系作者：VX：yinhuidong666</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%EF%BC%8Corm%E6%80%9D%E6%83%B3%E5%92%8Chibernate%E4%BB%A5%E5%8F%8Ajpa"><span class="toc-text">一，orm思想和hibernate以及jpa</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-orm%E6%80%9D%E6%83%B3"><span class="toc-text">1.orm思想</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-hibernate%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D"><span class="toc-text">2. hibernate框架介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-jpa%E8%A7%84%E8%8C%83"><span class="toc-text">3.jpa规范</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JPA%E4%B8%8Ehibernate%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-text">JPA与hibernate的关系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-jpa%E7%9A%84%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">4.jpa的入门案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%A1%88%E4%BE%8B%EF%BC%9A%E6%98%AF%E5%AE%A2%E6%88%B7%E7%9A%84%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%EF%BC%88%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%EF%BC%89"><span class="toc-text">1.案例：是客户的相关操作（增删改查）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">2.创建项目导入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">3.配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-text">4.实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-text">5.测试类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#jpa%E6%93%8D%E4%BD%9C%E7%9A%84%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="toc-text">jpa操作的操作步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-text">测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%B8%BB%E9%94%AE%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5"><span class="toc-text">5.主键生成策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-JPA%E7%9A%84API%E4%BB%8B%E7%BB%8D"><span class="toc-text">6.JPA的API介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Persistence%E5%AF%B9%E8%B1%A1"><span class="toc-text">1.Persistence对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-EntityManagerFactory"><span class="toc-text">2.EntityManagerFactory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-EntityManager"><span class="toc-text">3. EntityManager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-EntityTransaction"><span class="toc-text">4.EntityTransaction</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%8A%BD%E5%8F%96JPAUtil%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">7.   抽取JPAUtil工具类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E4%BD%BF%E7%94%A8JPA%E5%AE%8C%E6%88%90%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5%E6%93%8D%E4%BD%9C"><span class="toc-text">8.   使用JPA完成增删改查操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BF%9D%E5%AD%98"><span class="toc-text">1.保存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%A0%E9%99%A4"><span class="toc-text">2.删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%9B%B4%E6%96%B0"><span class="toc-text">3.更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%A0%B9%E6%8D%AEID%E6%9F%A5%E8%AF%A2"><span class="toc-text">4.根据ID查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E7%AB%8B%E5%8D%B3%E5%8A%A0%E8%BD%BD"><span class="toc-text">1）立即加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-text">2）懒加载</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2"><span class="toc-text">5.复杂查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%9F%A5%E8%AF%A2%E5%85%A8%E9%83%A8"><span class="toc-text">1)查询全部</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-text">2）分页查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-text">3）条件查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2"><span class="toc-text">4）排序查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%EF%BC%89%E7%BB%9F%E8%AE%A1%E6%9F%A5%E8%AF%A2"><span class="toc-text">5）统计查询</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%EF%BC%8Cspringdatajpa%E7%9A%84%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E4%BB%A5%E5%8F%8A%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-text">二，springdatajpa的运行原理以及基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-springDataJpa%E6%A6%82%E8%BF%B0"><span class="toc-text">1.springDataJpa概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1SpringDataJpa%E6%A6%82%E8%BF%B0"><span class="toc-text">1.1SpringDataJpa概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2springdatajpa%E7%9A%84%E7%89%B9%E6%80%A7"><span class="toc-text">1.2springdatajpa的特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3Spring-Data-JPA-%E4%B8%8E-JPA%E5%92%8Chibernate%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-text">1.3Spring Data JPA 与 JPA和hibernate之间的关系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-SpringDataJpa%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">2.SpringDataJpa快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E9%9C%80%E6%B1%82%E8%AF%B4%E6%98%8E"><span class="toc-text">2.1需求说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83"><span class="toc-text">2.2搭建环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E4%BE%9D%E8%B5%96"><span class="toc-text">项目依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Spring%E6%95%B4%E5%90%88SpringDataJPA"><span class="toc-text">Spring整合SpringDataJPA</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E8%81%94%E6%98%A0%E5%B0%84%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-text">关联映射实体类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mapper%E6%8E%A5%E5%8F%A3"><span class="toc-text">mapper接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-text">测试类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-SpringDataJPA%E7%9A%84%E5%BA%95%E5%B1%82%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-text">3.SpringDataJPA的底层代码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E5%B8%B8%E7%94%A8%E6%8E%A5%E5%8F%A3%E5%88%86%E6%9E%90"><span class="toc-text">3.1常用接口分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2SpringDataJPA%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B"><span class="toc-text">3.2SpringDataJPA的实现过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-SpringDataJPA%E7%9A%84%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F"><span class="toc-text">4.SpringDataJPA的查询方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%E4%BD%BF%E7%94%A8jpql%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9F%A5%E8%AF%A2"><span class="toc-text">4.1使用jpql的方式查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E4%BD%BF%E7%94%A8SQL%E8%AF%AD%E5%8F%A5%E6%9F%A5%E8%AF%A2"><span class="toc-text">4.2使用SQL语句查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%E6%96%B9%E6%B3%95%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99%E6%9F%A5%E8%AF%A2"><span class="toc-text">4.3方法命名规则查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%EF%BC%8CspringdataJpa%E7%9A%84%E5%8A%A8%E6%80%81%E6%9F%A5%E8%AF%A2%E4%B8%8E%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-text">三，springdataJpa的动态查询与多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%8A%A8%E6%80%81%E6%9F%A5%E8%AF%A2"><span class="toc-text">1.动态查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%BD%BF%E7%94%A8Specifications%E5%AE%8C%E6%88%90%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-text">1.1  使用Specifications完成条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2%E5%9F%BA%E4%BA%8ESpecification%E7%9A%84%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-text">1.2基于Specification的分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3%E6%96%B9%E6%B3%95%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB"><span class="toc-text">1.3方法对应关系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%A4%9A%E8%A1%A8%E8%AE%BE%E8%AE%A1"><span class="toc-text">2.多表设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E8%A1%A8%E4%B9%8B%E9%97%B4%E5%85%B3%E7%B3%BB%E7%9A%84%E5%88%92%E5%88%86"><span class="toc-text">2.1表之间关系的划分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%9C%A8JPA%E6%A1%86%E6%9E%B6%E4%B8%AD%E8%A1%A8%E5%85%B3%E7%B3%BB%E7%9A%84%E5%88%86%E6%9E%90%E6%AD%A5%E9%AA%A4"><span class="toc-text">2.2  在JPA框架中表关系的分析步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-jpa%E4%B8%AD%E7%9A%84%E4%B8%80%E5%AF%B9%E5%A4%9A"><span class="toc-text">3.jpa中的一对多</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E6%83%85%E6%99%AF%E6%A8%A1%E6%8B%9F"><span class="toc-text">3.1情景模拟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%E8%A1%A8%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B"><span class="toc-text">3.2表关系建立</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B%E4%BB%A5%E5%8F%8A%E6%98%A0%E5%B0%84%E9%85%8D%E7%BD%AE"><span class="toc-text">3.3  实体类关系建立以及映射配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4%E6%98%A0%E5%B0%84%E7%9A%84%E6%B3%A8%E8%A7%A3%E8%AF%B4%E6%98%8E"><span class="toc-text">3.4映射的注解说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#OneToMany"><span class="toc-text">@OneToMany:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ManyToOne"><span class="toc-text">**@ManyToOne **** **</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JoinColumn"><span class="toc-text">**@JoinColumn **** **</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5%E4%B8%80%E5%AF%B9%E5%A4%9A%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">3.5一对多的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E6%B7%BB%E5%8A%A0"><span class="toc-text">1）添加</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E5%88%A0%E9%99%A4"><span class="toc-text">2）删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E7%BA%A7%E8%81%94%E6%93%8D%E4%BD%9C"><span class="toc-text">3）级联操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-jpa%E4%B8%AD%E7%9A%84%E5%A4%9A%E5%AF%B9%E5%A4%9A"><span class="toc-text">4.jpa中的多对多</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%83%85%E6%99%AF%E6%A8%A1%E6%8B%9F"><span class="toc-text">4.1.情景模拟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E8%A1%A8%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B"><span class="toc-text">4.2表关系建立</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%E5%AE%9E%E4%BD%93%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B%E4%BB%A5%E5%8F%8A%E6%98%A0%E5%B0%84%E9%85%8D%E7%BD%AE"><span class="toc-text">4.3实体关系建立以及映射配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4%E6%98%A0%E5%B0%84%E7%9A%84%E6%B3%A8%E8%A7%A3%E8%AF%B4%E6%98%8E"><span class="toc-text">4.4映射的注解说明</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ManyToMany"><span class="toc-text">**@ManyToMany **** **</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JoinTable"><span class="toc-text">**@JoinTable **** **</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JoinColumn-1"><span class="toc-text">**@JoinColumn **** **</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5%E5%A4%9A%E5%AF%B9%E5%A4%9A%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">4.5多对多的操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-SpringDataJPA%E7%9A%84%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-text">5.SpringDataJPA的多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%AF%BC%E8%88%AA%E5%9B%BE%E6%9F%A5%E8%AF%A2"><span class="toc-text">对象导航图查询</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/01/20/MySQL/MySQL%5B%E4%BA%8C%E5%8D%81%5D%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%80%BB%E7%BB%93/" title="MySQL[二十]海量数据处理"><img src="/images/cover/mysql.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL[二十]海量数据处理"/></a><div class="content"><a class="title" href="/2022/01/20/MySQL/MySQL%5B%E4%BA%8C%E5%8D%81%5D%E6%B5%B7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%80%BB%E7%BB%93/" title="MySQL[二十]海量数据处理">MySQL[二十]海量数据处理</a><time datetime="2022-01-19T16:00:00.000Z" title="发表于 2022-01-20 00:00:00">2022-01-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/16/MySQL/MySQL%5B%E5%8D%81%E5%85%AD%5D%E5%B9%B6%E5%8F%91%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6-MVCC/" title="MySQL[十六]并发版本控制-MVCC"><img src="/images/cover/mysql.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL[十六]并发版本控制-MVCC"/></a><div class="content"><a class="title" href="/2022/01/16/MySQL/MySQL%5B%E5%8D%81%E5%85%AD%5D%E5%B9%B6%E5%8F%91%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6-MVCC/" title="MySQL[十六]并发版本控制-MVCC">MySQL[十六]并发版本控制-MVCC</a><time datetime="2022-01-15T16:00:00.000Z" title="发表于 2022-01-16 00:00:00">2022-01-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/15/MySQL/MySQL%5B%E5%8D%81%E4%BA%94%5Dundo%E6%97%A5%E5%BF%97/" title="MySQL[十五]undo日志"><img src="/images/cover/mysql.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL[十五]undo日志"/></a><div class="content"><a class="title" href="/2022/01/15/MySQL/MySQL%5B%E5%8D%81%E4%BA%94%5Dundo%E6%97%A5%E5%BF%97/" title="MySQL[十五]undo日志">MySQL[十五]undo日志</a><time datetime="2022-01-14T16:00:00.000Z" title="发表于 2022-01-15 00:00:00">2022-01-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/14/MySQL/MySQL%5B%E5%8D%81%E5%9B%9B%5Dredo%E6%97%A5%E5%BF%97/" title="MySQL[十四]redo日志"><img src="/images/cover/mysql.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL[十四]redo日志"/></a><div class="content"><a class="title" href="/2022/01/14/MySQL/MySQL%5B%E5%8D%81%E5%9B%9B%5Dredo%E6%97%A5%E5%BF%97/" title="MySQL[十四]redo日志">MySQL[十四]redo日志</a><time datetime="2022-01-13T16:00:00.000Z" title="发表于 2022-01-14 00:00:00">2022-01-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/01/13/MySQL/MySQL%5B%E5%8D%81%E4%B8%89%5D%E4%BA%8B%E5%8A%A1/" title="MySQL[十三]事务"><img src="/images/cover/mysql.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL[十三]事务"/></a><div class="content"><a class="title" href="/2022/01/13/MySQL/MySQL%5B%E5%8D%81%E4%B8%89%5D%E4%BA%8B%E5%8A%A1/" title="MySQL[十三]事务">MySQL[十三]事务</a><time datetime="2022-01-12T16:00:00.000Z" title="发表于 2022-01-13 00:00:00">2022-01-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/images/cover/MyBatis.png')"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By 二十</div><div class="footer_custom_text">树是生活，埋的是我。看花就好，别看我落魄。</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/chocolate.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="二十,二十二十,二十二十二十,二十二十二十二十,二十二十二十二十二十" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>